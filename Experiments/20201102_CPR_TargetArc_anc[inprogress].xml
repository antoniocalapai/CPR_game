<?xml version='1.0' encoding='UTF-8'?>
<monkeyml version="1.0">
  <iodevice _location="line 6, column 1" background_color="0, 0, 0" tag="Stimulus Display" type="stimulus_display" />
  <iodevice _location="line 7, column 1" data_interval="1 ms" joystick_direction="IO_joystickDirection" joystick_strength="IO_joystickStrength" joystick_x_calib="IO_joystickX_calib" joystick_x_raw="IO_joystickX_raw" joystick_y_calib="IO_joystickY_calib" joystick_y_raw="IO_joystickY_raw" reward_a="IO_rewardA" tag="mIO" type="mio" />
  <iodevice _location="line 17, column 1" hide_cursor="YES" mouse_down="IO_mouse_down" mouse_position_x="IO_mouse_x" mouse_position_y="IO_mouse_y" tag="mouse" type="mouse_input" use_mirror_window="YES" />
  <folder _location="line 29, column 1" tag="EXP">
    <variable _location="line 30, column 5" default_value="0" tag="EXP_task" />
    <variable _location="line 31, column 5" default_value="15.2024" tag="EXP_Xmax" />
    <variable _location="line 32, column 5" default_value="11.4018" tag="EXP_Ymax" />
    <variable _location="line 33, column 5" default_value=".9" tag="EXP_snr_min" />
    <variable _location="line 34, column 5" default_value="1" tag="EXP_snr_max" />
    <variable _location="line 35, column 5" default_value="0" tag="EXP_SteadyStateDuration" />
    <variable _location="line 36, column 5" default_value="0" tag="EXP_Time2Target" />
    <variable _location="line 37, column 5" default_value="[45, 90, 135, 180]" tag="EXP_directionChange_list" />
    <variable _location="line 38, column 5" default_value="0" tag="EXP_RDPdir_change" />
    <variable _location="line 39, column 5" default_value="500" tag="EXP_steadyState_min" />
    <variable _location="line 40, column 5" default_value="0" tag="EXP_trial_duration" />
    <variable _location="line 41, column 5" default_value="10000" tag="EXP_trial_min" />
    <variable _location="line 42, column 5" default_value="20000" tag="EXP_trial_max" />
    <variable _location="line 43, column 5" default_value="1000" tag="EXP_ITI_ms" />
    <variable _location="line 44, column 5" default_value="500" tag="EXP_HoldTarget_ms" />
    <variable _location="line 45, column 5" default_value="500" tag="EXP_start_area_colorChange_ms" />
  </folder>
  <folder _location="line 47, column 1" tag="IO">
    <variable _location="line 48, column 5" default_value="(float)(0)" tag="IO_mouse_x" />
    <variable _location="line 49, column 5" default_value="(float)(0)" tag="IO_mouse_y" />
    <variable _location="line 50, column 5" default_value="(float)(0)" tag="IO_mouse_down" />
    <variable _location="line 51, column 5" default_value="(float)(0)" tag="IO_joystickDirection" />
    <variable _location="line 52, column 5" default_value="0" tag="IO_joystickStrength" />
    <variable _location="line 53, column 5" default_value="0" tag="IO_joystickX_raw" />
    <variable _location="line 54, column 5" default_value="0" tag="IO_joystickY_raw" />
    <variable _location="line 55, column 5" default_value="(float)(0)" tag="IO_joystickX_calib" />
    <variable _location="line 56, column 5" default_value="(float)(0)" tag="IO_joystickY_calib" />
    <variable _location="line 57, column 5" default_value="0" tag="IO_start_area_flag" />
    <variable _location="line 58, column 5" default_value="2" tag="IO_start_area_size" />
    <variable _location="line 59, column 5" default_value="0" tag="IO_start_area_col_r" />
    <variable _location="line 60, column 5" default_value="0" tag="IO_start_area_col_g" />
    <variable _location="line 61, column 5" default_value="0" tag="IO_start_area_col_b" />
    <variable _location="line 62, column 5" default_value="0" tag="IO_rewardA" />
    <variable _location="line 63, column 5" default_value="0" tag="IO_cursor_distance2center" />
    <variable _location="line 64, column 5" default_value="0" tag="IO_cursor_accuracy" />
    <variable _location="line 65, column 5" default_value="0" tag="IO_cursor_accuracyDisplay" />
    <variable _location="line 66, column 5" default_value="0" tag="IO_cursor_x" />
    <variable _location="line 67, column 5" default_value="0" tag="IO_cursor_y" />
  </folder>
  <folder _location="line 69, column 1" tag="Target">
    <variable _location="line 70, column 5" default_value="2" tag="IO_target_size" />
    <variable _location="line 71, column 5" default_value="0" tag="IO_target_ON" />
    <variable _location="line 72, column 5" default_value="1000" tag="IO_target_duration" />
    <variable _location="line 73, column 5" default_value="0" tag="IO_target_flag" />
    <variable _location="line 74, column 5" default_value="0" tag="IO_target_x" />
    <variable _location="line 75, column 5" default_value="9.25" tag="IO_target_y" />
    <variable _location="line 76, column 5" default_value="0.5" tag="IO_target_alpha" />
    <variable _location="line 77, column 5" default_value=".5" tag="IO_target_col_r" />
    <variable _location="line 78, column 5" default_value=".5" tag="IO_target_col_g" />
    <variable _location="line 79, column 5" default_value=".5" tag="IO_target_col_b" />
    <variable _location="line 80, column 5" default_value="0" tag="IO_arc_width" />
    <variable _location="line 81, column 5" default_value="20" tag="IO_arc_size" />
    <variable _location="line 82, column 5" default_value="0" tag="IO_arc_flag" />
    <variable _location="line 83, column 5" default_value="0" tag="IO_arc_alpha" />
    <variable _location="line 84, column 5" default_value="0.5" tag="IO_arc_trigger_min" />
    <variable _location="line 85, column 5" default_value="0.5" tag="IO_arc_trigger_max" />
    <variable _location="line 86, column 5" default_value="17" tag="IO_arcMask_size" />
    <variable _location="line 87, column 5" default_value="0" tag="IO_arcMask_flag" />
    <variable _location="line 88, column 5" default_value="1" tag="IO_arc_col_r" />
    <variable _location="line 89, column 5" default_value="1" tag="IO_arc_col_g" />
    <variable _location="line 90, column 5" default_value="0" tag="IO_arc_col_b" />
  </folder>
  <folder _location="line 92, column 1" tag="TMP">
    <variable _location="line 93, column 5" default_value="0" tag="alpha" />
    <variable _location="line 94, column 5" default_value="3.14159265359" tag="pi" />
    <variable _location="line 95, column 5" default_value="0" tag="TMP_stimDir" />
    <variable _location="line 96, column 5" default_value="0" tag="TMP_joyDeviation" />
    <variable _location="line 97, column 5" default_value="0" tag="TMP_normStimDir" />
    <variable _location="line 98, column 5" default_value="0" tag="TMP_normJoyDir" />
    <variable _location="line 99, column 5" default_value="0" tag="TMP_scalingFactor" />
    <variable _location="line 100, column 5" default_value="0" tag="dice" />
    <variable _location="line 101, column 5" default_value="0" tag="steady_ts" />
  </folder>
  <folder _location="line 103, column 1" tag="RDP">
    <variable _location="line 104, column 5" default_value="8" tag="RDP_radius" />
    <variable _location="line 105, column 5" default_value="0" tag="RDP_direction" />
    <variable _location="line 106, column 5" default_value="0" tag="RDP_controlled_x" />
    <variable _location="line 107, column 5" default_value="0" tag="RDP_target_x" />
    <variable _location="line 108, column 5" default_value="0" tag="RDP_y" />
    <variable _location="line 109, column 5" default_value="0" tag="RDP_x" />
    <variable _location="line 110, column 5" default_value="5" tag="RDP_density" />
    <variable _location="line 111, column 5" default_value="0.2" tag="RDP_dotsize" />
    <variable _location="line 112, column 5" default_value="3" tag="RDP_speed" />
    <variable _location="line 113, column 5" default_value="0" tag="RDP_coherence" />
    <variable _location="line 114, column 5" default_value="0.3" tag="RDP_lifetime" />
  </folder>
  <folder _location="line 116, column 1" tag="ML">
    <variable _location="line 117, column 5" default_value="0" tag="ML_trialEnd" />
    <variable _location="line 118, column 5" default_value="0" tag="ML_trialStart" />
    <variable _location="line 119, column 5" default_value="(bool)(0)" tag="ML_sync" />
    <variable _location="line 120, column 5" default_value="0" tag="TRIAL_outcome" />
  </folder>
  <sound _location="line 127, column 1" path="./sounds/reward.wav" tag="Reward" type="wav_file" />
  <stimulus _location="line 133, column 1" tag="Background" type="blank_screen" />
  <stimulus _location="line 134, column 1" alpha_multiplier=".3" color="IO_start_area_col_r, IO_start_area_col_g, IO_start_area_col_b" rotation="0" tag="start_area" trigger_flag="IO_start_area_flag" trigger_watch_x="IO_cursor_x" trigger_watch_y="IO_cursor_y" trigger_width="IO_start_area_size" type="circular_fixation_point" x_position="0" x_size="IO_start_area_size" y_position="0" y_size="IO_start_area_size" />
  <stimulus _location="line 147, column 1" alpha_multiplier="1.0" announce_dots="NO" autoplay="YES" coherence="RDP_coherence" color="1, 1, 1" direction="RDP_direction" dot_density="RDP_density" dot_size="RDP_dotsize" lifetime="RDP_lifetime" radius="RDP_radius" speed="RDP_speed" tag="RDP" type="r_d_p" x_position="RDP_x" y_position="RDP_y" />
  <stimulus _location="line 162, column 1" alpha_multiplier="1" color="IO_arc_col_r, IO_arc_col_g, IO_arc_col_b" rotation="0" tag="cursor" trigger_flag="0" trigger_watch_x="0" trigger_watch_y="0" trigger_width="0" type="circular_fixation_point" x_position="-EXP_Xmax * IO_joystickX_calib" x_size="1" y_position="EXP_Ymax * IO_joystickY_calib" y_size="1" />
  <stimulus _location="line 175, column 1" alpha_multiplier="IO_target_alpha" color="IO_target_col_r, IO_target_col_g, IO_target_col_b" rotation="0" tag="target" trigger_flag="IO_target_flag" trigger_watch_x="IO_cursor_x" trigger_watch_y="IO_cursor_y" trigger_width="IO_target_size" type="circular_fixation_point" x_position="IO_target_x" x_size="IO_target_size" y_position="IO_target_y" y_size="IO_target_size" />
  <stimulus _location="line 188, column 1" alpha_multiplier="IO_arc_alpha" autoplay="YES" color="IO_arc_col_r, IO_arc_col_g, IO_arc_col_b" rotation="-(IO_joystickDirection - 90 - IO_arc_width / 2)" shape="format(&quot;circle %d&quot;, (integer)IO_arc_width)" tag="arc" trigger_flag="IO_arc_flag" trigger_watch_x="IO_target_x" trigger_watch_y="IO_target_y" trigger_width="IO_arc_size" type="advstimulus" version="1" x_position="0" x_size="IO_arc_size" y_position="0" y_size="IO_arc_size" />
  <stimulus _location="line 204, column 1" alpha_multiplier="1" color="0.5, 0.5, 0.5" rotation="0" tag="arcMask" trigger_flag="IO_arcMask_flag" trigger_watch_x="IO_cursor_x" trigger_watch_y="IO_cursor_x" trigger_width="IO_arcMask_size" type="circular_fixation_point" x_position="0" x_size="IO_arcMask_size" y_position="0" y_size="IO_arcMask_size" />
  <stimulus _location="line 217, column 1" alpha_multiplier="1" color="1, 1, 1" font_name="Arial" font_size="20" rotation="0" tag="feedback_accuracy" text="format(&quot;Accuracy: %d&quot;, IO_cursor_accuracyDisplay)" type="text" x_position="-10" x_size="10" y_position="3" y_size="10" />
  <stimulus _location="line 229, column 1" alpha_multiplier="1" color="1, 1, 1" font_name="Arial" font_size="20" rotation="0" tag="feedback_distance" text="format(&quot;Dist2Center: %d&quot;, IO_cursor_distance2center)" type="text" x_position="-10" x_size="10" y_position="4" y_size="10" />
  <experiment tag="Experiment">
    <protocol _location="line 261, column 1" tag="CPR_steady">
      <action _location="line 262, column 5" device="mIO" type="start_device_io" />
      <action _location="line 263, column 5" stimulus="Background" type="live_queue_stimulus" />
      <action _location="line 264, column 5" stimulus="cursor" type="live_queue_stimulus" />
      <action _location="line 265, column 5" stimulus="feedback_accuracy" type="live_queue_stimulus" />
      <action _location="line 266, column 5" stimulus="feedback_distance" type="live_queue_stimulus" />
      <action _location="line 267, column 5" type="update_stimulus_display" />
      <action _location="line 268, column 5" duration="0.0" duration_units="ms" timer="ColorChangeTimer" type="start_timer" />
      <trial _location="line 273, column 5" tag="Trial structure">
        <task_system _location="line 274, column 9" tag="LOOP">
          <task_system_state _location="line 275, column 13" tag="Wait for Joystick">
            <action _location="line 276, column 17" duration="16" duration_units="ms" timer="FrameTimer" type="start_timer" />
            <action _location="line 281, column 17" condition="1" type="if">
              <action _location="line 282, column 33" type="assignment" value="-(EXP_Xmax * IO_joystickX_calib)" variable="IO_cursor_x" />
              <action _location="line 283, column 33" type="assignment" value="EXP_Ymax * IO_joystickY_calib" variable="IO_cursor_y" />
            </action>
            <action _location="line 285, column 17" stimulus="start_area" type="queue_stimulus" />
            <action _location="line 286, column 17" type="update_stimulus_display" />
            <transition _location="line 287, column 17" target="New Trial" type="goto" when="IO_start_area_flag == true" />
            <transition _location="line 291, column 17" target="Wait for Joystick" timer="FrameTimer" type="timer_expired" />
          </task_system_state>
          <task_system_state _location="line 296, column 13" tag="New Trial">
            <action _location="line 297, column 17" condition="1" type="if">
              <action _location="line 298, column 29" type="assignment" value="1" variable="ML_sync" />
              <action _location="line 299, column 35" type="assignment" value="ML_trialStart + 1" variable="ML_trialStart" />
              <action _location="line 300, column 30" type="assignment" value="&quot;Steady_Flip&quot;" variable="EXP_task" />
            </action>
            <action _location="line 302, column 17" condition="1" type="if">
              <action _location="line 303, column 35" type="assignment" value="disc_rand(0, 359)" variable="RDP_direction" />
              <action _location="line 304, column 31" type="assignment" value="4" variable="RDP_speed" />
              <action _location="line 305, column 35" type="assignment" value="rand(EXP_snr_min, EXP_snr_max)" variable="RDP_coherence" />
            </action>
            <action _location="line 307, column 17" type="update_stimulus_display" />
            <action _location="line 308, column 36" type="assignment" value="disc_rand(EXP_trial_min, EXP_trial_max)" variable="EXP_trial_duration" />
            <action _location="line 309, column 17" duration="EXP_trial_duration" duration_units="ms" timer="TrialTimer" type="start_timer" />
            <action _location="line 314, column 17" message="===== TRIAL $ML_trialStart STARTS=====" type="report" />
            <transition _location="line 315, column 17" target="Show Stimuli" type="goto" />
          </task_system_state>
          <task_system_state _location="line 317, column 13" tag="Show Stimuli">
            <action _location="line 318, column 17" condition="1" type="if">
              <action _location="line 319, column 21" stimulus="arc" type="live_queue_stimulus" />
              <action _location="line 320, column 21" stimulus="arcMask" type="live_queue_stimulus" />
              <action _location="line 321, column 21" stimulus="RDP" type="live_queue_stimulus" />
              <action _location="line 322, column 21" stimulus="start_area" type="live_queue_stimulus" />
              <action _location="line 323, column 21" stimulus="cursor" type="live_queue_stimulus" />
              <action _location="line 324, column 21" type="update_stimulus_display" />
            </action>
            <transition _location="line 326, column 17" target="Set up Target" type="goto" />
          </task_system_state>
          <task_system_state _location="line 328, column 13" tag="Set up Target">
            <action _location="line 329, column 33" type="assignment" value="1500 * disc_rand(1, 6)" variable="EXP_Time2Target" />
            <action _location="line 330, column 17" duration="EXP_Time2Target" duration_units="ms" timer="TargetTimer" type="start_timer" />
            <transition _location="line 335, column 17" target="Set up steady state" type="goto" />
          </task_system_state>
          <task_system_state _location="line 337, column 13" tag="Set up steady state">
            <action _location="line 338, column 41" type="assignment" value="disc_rand(1000, 3000)" variable="EXP_SteadyStateDuration" />
            <action _location="line 339, column 17" duration="EXP_SteadyStateDuration" duration_units="ms" timer="SteadyStateDurationTimer" type="start_timer" />
            <action _location="line 344, column 17" duration="EXP_steadyState_min" duration_units="ms" timer="SteadyStateMinDurationTimer" type="start_timer" />
            <action _location="line 349, column 27" type="assignment" value="now()" variable="steady_ts" />
            <transition _location="line 350, column 17" target="Update Stimuli" type="goto" />
          </task_system_state>
          <task_system_state _location="line 352, column 13" tag="Update Stimuli">
            <action _location="line 353, column 17" duration="16" duration_units="ms" timer="FrameTimer" type="start_timer" />
            <action _location="line 358, column 17" condition="timer_expired(ColorChangeTimer)" type="if">
              <action _location="line 359, column 41" type="assignment" value="0" variable="IO_start_area_col_g" />
            </action>
            <action _location="line 361, column 17" condition="1" type="if">
              <action _location="line 362, column 33" type="assignment" value="-(EXP_Xmax * IO_joystickX_calib)" variable="IO_cursor_x" />
              <action _location="line 363, column 33" type="assignment" value="EXP_Ymax * IO_joystickY_calib" variable="IO_cursor_y" />
            </action>
            <action _location="line 365, column 17" condition="1" type="if">
              <action _location="line 366, column 40" type="assignment" value="(((TMP_stimDir - (IO_arc_width / 2) + 360) % 360) + ((180 - TMP_stimDir) + 360)) % 360" variable="IO_arc_trigger_min" />
              <action _location="line 367, column 40" type="assignment" value="(((TMP_stimDir + (IO_arc_width / 2) + 360) % 360) + ((180 - TMP_stimDir) + 360)) % 360" variable="IO_arc_trigger_max" />
            </action>
            <action _location="line 369, column 17" condition="1" type="if">
              <action _location="line 370, column 27" type="assignment" value="RDP_direction" variable="alpha" />
              <action _location="line 371, column 21" condition="alpha &gt;= 0 &amp;&amp; alpha &lt; 359" type="if">
                <action _location="line 372, column 37" type="assignment" value="alpha" variable="TMP_stimDir" />
              </action>
              <action _location="line 374, column 21" condition="alpha &gt; 359" type="if">
                <action _location="line 375, column 37" type="assignment" value="alpha - 359" variable="TMP_stimDir" />
              </action>
              <action _location="line 377, column 21" condition="alpha &lt; 0" type="if">
                <action _location="line 378, column 37" type="assignment" value="alpha + 359" variable="TMP_stimDir" />
              </action>
              <action _location="line 380, column 40" type="assignment" value="abs(1 - abs(TMP_stimDir - (IO_joystickDirection - 90)) / 180)" variable="IO_cursor_accuracy" />
              <action _location="line 381, column 47" type="assignment" value="round(IO_cursor_accuracy * 100) / 100" variable="IO_cursor_accuracyDisplay" />
            </action>
            <action _location="line 383, column 17" condition="1" type="if">
              <action _location="line 384, column 36" type="assignment" value="(((IO_joystickDirection - 90) + (180 - TMP_stimDir) + 360) % 360)" variable="TMP_normJoyDir" />
              <action _location="line 385, column 37" type="assignment" value="(((TMP_stimDir + 360) % 360) + ((180 - TMP_stimDir) + 360)) % 360" variable="TMP_normStimDir" />
              <action _location="line 386, column 38" type="assignment" value="abs(TMP_normJoyDir - TMP_normStimDir)" variable="TMP_joyDeviation" />
              <action _location="line 387, column 47" type="assignment" value="sqrt(pow(IO_cursor_y, 2) + pow(IO_cursor_x, 2))" variable="IO_cursor_distance2center" />
            </action>
            <action _location="line 389, column 17" condition="1" type="if">
              <action _location="line 390, column 21" condition="IO_cursor_distance2center &lt;= RDP_radius" type="if">
                <action _location="line 391, column 43" type="assignment" value="IO_cursor_distance2center" variable="TMP_scalingFactor" />
              </action>
              <action _location="line 393, column 21" condition="IO_cursor_distance2center &gt; RDP_radius" type="if">
                <action _location="line 394, column 43" type="assignment" value="RDP_radius" variable="TMP_scalingFactor" />
              </action>
              <action _location="line 396, column 34" type="assignment" value="180 * (abs(TMP_scalingFactor - RDP_radius) / RDP_radius)" variable="IO_arc_width" />
            </action>
            <action _location="line 398, column 17" condition="1" type="if">
              <action _location="line 399, column 34" type="assignment" value="IO_cursor_distance2center / RDP_radius" variable="IO_arc_alpha" />
              <action _location="line 400, column 37" type="assignment" value="IO_cursor_distance2center / RDP_radius" variable="IO_target_alpha" />
            </action>
            <action _location="line 402, column 17" type="update_stimulus_display" />
            <transition _location="line 403, column 17" target="Direction switch" timer="SteadyStateDurationTimer" type="timer_expired" />
            <transition _location="line 407, column 17" target="Target presentation" type="goto" when="timer_expired(TargetTimer) &amp;&amp; timer_expired(SteadyStateMinDurationTimer)" />
            <transition _location="line 411, column 17" target="End Trial" timer="TrialTimer" type="timer_expired" />
            <transition _location="line 415, column 17" target="Update Stimuli" timer="FrameTimer" type="timer_expired" />
          </task_system_state>
          <task_system_state _location="line 420, column 13" tag="Direction switch">
            <action _location="line 421, column 22" type="assignment" value="disc_rand(0, 1)" variable="dice" />
            <action _location="line 422, column 35" type="assignment" value="EXP_directionChange_list[disc_rand(0, 3)]" variable="EXP_RDPdir_change" />
            <action _location="line 423, column 17" condition="dice == 1" type="if">
              <action _location="line 424, column 35" type="assignment" value="RDP_direction + EXP_RDPdir_change" variable="RDP_direction" />
            </action>
            <action _location="line 426, column 17" condition="dice == 0" type="if">
              <action _location="line 427, column 35" type="assignment" value="RDP_direction - EXP_RDPdir_change" variable="RDP_direction" />
            </action>
            <transition _location="line 429, column 17" target="Set up steady state" type="goto" />
          </task_system_state>
          <task_system_state _location="line 431, column 13" tag="Target presentation">
            <action _location="line 432, column 17" condition="1" type="if">
              <action _location="line 433, column 33" type="assignment" value="sin((RDP_direction) * (pi / 180)) * (RDP_radius + (IO_target_size / 2))" variable="IO_target_x" />
              <action _location="line 434, column 33" type="assignment" value="cos((RDP_direction) * (pi / 180)) * (RDP_radius + (IO_target_size / 2))" variable="IO_target_y" />
            </action>
            <action _location="line 436, column 17" stimulus="target" type="live_queue_stimulus" />
            <action _location="line 437, column 30" type="assignment" value="1" variable="IO_target_ON" />
            <action _location="line 438, column 17" duration="IO_target_duration" duration_units="ms" timer="TargetDurationTimer" type="start_timer" />
            <action _location="line 443, column 17" message="--- SHOW TARGET ---" type="report" />
            <transition _location="line 444, column 17" target="Check if target detected" type="goto" />
          </task_system_state>
          <task_system_state _location="line 446, column 13" tag="Check if target detected">
            <action _location="line 447, column 17" duration="16" duration_units="ms" timer="FrameTimer" type="start_timer" />
            <action _location="line 452, column 17" condition="IO_start_area_col_g == 1" type="if">
              <action _location="line 453, column 41" type="assignment" value="0" variable="IO_start_area_col_g" />
            </action>
            <action _location="line 455, column 17" condition="1" type="if">
              <action _location="line 456, column 33" type="assignment" value="-(EXP_Xmax * IO_joystickX_calib)" variable="IO_cursor_x" />
              <action _location="line 457, column 33" type="assignment" value="EXP_Ymax * IO_joystickY_calib" variable="IO_cursor_y" />
            </action>
            <action _location="line 459, column 17" condition="1" type="if">
              <action _location="line 460, column 40" type="assignment" value="(((TMP_stimDir - (IO_arc_width / 2) + 360) % 360) + ((180 - TMP_stimDir) + 360)) % 360" variable="IO_arc_trigger_min" />
              <action _location="line 461, column 40" type="assignment" value="(((TMP_stimDir + (IO_arc_width / 2) + 360) % 360) + ((180 - TMP_stimDir) + 360)) % 360" variable="IO_arc_trigger_max" />
            </action>
            <action _location="line 463, column 17" condition="1" type="if">
              <action _location="line 464, column 27" type="assignment" value="RDP_direction" variable="alpha" />
              <action _location="line 465, column 21" condition="alpha &gt;= 0 &amp;&amp; alpha &lt; 359" type="if">
                <action _location="line 466, column 37" type="assignment" value="alpha" variable="TMP_stimDir" />
              </action>
              <action _location="line 468, column 21" condition="alpha &gt; 359" type="if">
                <action _location="line 469, column 37" type="assignment" value="alpha - 359" variable="TMP_stimDir" />
              </action>
              <action _location="line 471, column 21" condition="alpha &lt; 0" type="if">
                <action _location="line 472, column 37" type="assignment" value="alpha + 359" variable="TMP_stimDir" />
              </action>
              <action _location="line 474, column 40" type="assignment" value="abs(1 - abs(TMP_stimDir - (IO_joystickDirection - 90)) / 180)" variable="IO_cursor_accuracy" />
              <action _location="line 475, column 47" type="assignment" value="round(IO_cursor_accuracy * 100) / 100" variable="IO_cursor_accuracyDisplay" />
            </action>
            <action _location="line 477, column 17" condition="1" type="if">
              <action _location="line 478, column 36" type="assignment" value="(((IO_joystickDirection - 90) + (180 - TMP_stimDir) + 360) % 360)" variable="TMP_normJoyDir" />
              <action _location="line 479, column 37" type="assignment" value="(((TMP_stimDir + 360) % 360) + ((180 - TMP_stimDir) + 360)) % 360" variable="TMP_normStimDir" />
              <action _location="line 480, column 38" type="assignment" value="abs(TMP_normJoyDir - TMP_normStimDir)" variable="TMP_joyDeviation" />
              <action _location="line 481, column 47" type="assignment" value="sqrt(pow(IO_cursor_y, 2) + pow(IO_cursor_x, 2))" variable="IO_cursor_distance2center" />
            </action>
            <action _location="line 483, column 17" condition="1" type="if">
              <action _location="line 484, column 21" condition="IO_cursor_distance2center &lt;= RDP_radius" type="if">
                <action _location="line 485, column 43" type="assignment" value="IO_cursor_distance2center" variable="TMP_scalingFactor" />
              </action>
              <action _location="line 487, column 21" condition="IO_cursor_distance2center &gt; RDP_radius" type="if">
                <action _location="line 488, column 43" type="assignment" value="RDP_radius" variable="TMP_scalingFactor" />
              </action>
              <action _location="line 490, column 34" type="assignment" value="180 * (abs(TMP_scalingFactor - RDP_radius) / RDP_radius)" variable="IO_arc_width" />
            </action>
            <action _location="line 492, column 17" condition="1" type="if">
              <action _location="line 493, column 34" type="assignment" value="IO_cursor_distance2center / RDP_radius" variable="IO_arc_alpha" />
              <action _location="line 494, column 37" type="assignment" value="IO_cursor_distance2center / RDP_radius" variable="IO_target_alpha" />
            </action>
            <action _location="line 496, column 17" condition="1" type="if">
              <action _location="line 497, column 33" type="assignment" value="(TMP_normJoyDir &gt;= IO_arc_trigger_min) &amp;&amp; (TMP_normJoyDir &lt;= IO_arc_trigger_max)" variable="IO_arc_flag" />
              <action _location="line 498, column 21" condition="IO_arc_flag" type="if">
                <action _location="line 499, column 41" type="assignment" value="0" variable="IO_target_col_r" />
                <action _location="line 500, column 41" type="assignment" value="0" variable="IO_target_col_g" />
                <action _location="line 501, column 41" type="assignment" value="0" variable="IO_target_col_b" />
              </action>
              <action _location="line 503, column 21" condition="IO_arc_flag == false" type="if">
                <action _location="line 504, column 41" type="assignment" value="0.5" variable="IO_target_col_r" />
                <action _location="line 505, column 41" type="assignment" value="0.5" variable="IO_target_col_g" />
                <action _location="line 506, column 41" type="assignment" value="0.5" variable="IO_target_col_b" />
              </action>
            </action>
            <action _location="line 509, column 17" type="update_stimulus_display" />
            <action _location="line 510, column 17" duration="EXP_HoldTarget_ms" duration_units="ms" timer="HoldDurationTimer" type="start_timer" />
            <transition _location="line 515, column 17" target="Hold target" type="goto" when="IO_arc_flag" />
            <transition _location="line 519, column 17" target="Miss" timer="TargetDurationTimer" type="timer_expired" />
            <transition _location="line 523, column 17" target="Check if target detected" timer="FrameTimer" type="timer_expired" />
          </task_system_state>
          <task_system_state _location="line 528, column 13" tag="Hold target">
            <action _location="line 529, column 17" duration="16" duration_units="ms" timer="FrameTimer" type="start_timer" />
            <action _location="line 534, column 17" condition="1" type="if">
              <action _location="line 535, column 33" type="assignment" value="-(EXP_Xmax * IO_joystickX_calib)" variable="IO_cursor_x" />
              <action _location="line 536, column 33" type="assignment" value="EXP_Ymax * IO_joystickY_calib" variable="IO_cursor_y" />
            </action>
            <action _location="line 538, column 17" condition="1" type="if">
              <action _location="line 539, column 40" type="assignment" value="(((TMP_stimDir - (IO_arc_width / 2) + 360) % 360) + ((180 - TMP_stimDir) + 360)) % 360" variable="IO_arc_trigger_min" />
              <action _location="line 540, column 40" type="assignment" value="(((TMP_stimDir + (IO_arc_width / 2) + 360) % 360) + ((180 - TMP_stimDir) + 360)) % 360" variable="IO_arc_trigger_max" />
            </action>
            <action _location="line 542, column 17" condition="1" type="if">
              <action _location="line 543, column 27" type="assignment" value="RDP_direction" variable="alpha" />
              <action _location="line 544, column 21" condition="alpha &gt;= 0 &amp;&amp; alpha &lt; 359" type="if">
                <action _location="line 545, column 37" type="assignment" value="alpha" variable="TMP_stimDir" />
              </action>
              <action _location="line 547, column 21" condition="alpha &gt; 359" type="if">
                <action _location="line 548, column 37" type="assignment" value="alpha - 359" variable="TMP_stimDir" />
              </action>
              <action _location="line 550, column 21" condition="alpha &lt; 0" type="if">
                <action _location="line 551, column 37" type="assignment" value="alpha + 359" variable="TMP_stimDir" />
              </action>
              <action _location="line 553, column 40" type="assignment" value="abs(1 - abs(TMP_stimDir - (IO_joystickDirection - 90)) / 180)" variable="IO_cursor_accuracy" />
              <action _location="line 554, column 47" type="assignment" value="round(IO_cursor_accuracy * 100) / 100" variable="IO_cursor_accuracyDisplay" />
            </action>
            <action _location="line 556, column 17" condition="1" type="if">
              <action _location="line 557, column 36" type="assignment" value="(((IO_joystickDirection - 90) + (180 - TMP_stimDir) + 360) % 360)" variable="TMP_normJoyDir" />
              <action _location="line 558, column 37" type="assignment" value="(((TMP_stimDir + 360) % 360) + ((180 - TMP_stimDir) + 360)) % 360" variable="TMP_normStimDir" />
              <action _location="line 559, column 38" type="assignment" value="abs(TMP_normJoyDir - TMP_normStimDir)" variable="TMP_joyDeviation" />
              <action _location="line 560, column 47" type="assignment" value="sqrt(pow(IO_cursor_y, 2) + pow(IO_cursor_x, 2))" variable="IO_cursor_distance2center" />
            </action>
            <action _location="line 562, column 17" condition="1" type="if">
              <action _location="line 563, column 21" condition="IO_cursor_distance2center &lt;= RDP_radius" type="if">
                <action _location="line 564, column 43" type="assignment" value="IO_cursor_distance2center" variable="TMP_scalingFactor" />
              </action>
              <action _location="line 566, column 21" condition="IO_cursor_distance2center &gt; RDP_radius" type="if">
                <action _location="line 567, column 43" type="assignment" value="RDP_radius" variable="TMP_scalingFactor" />
              </action>
              <action _location="line 569, column 34" type="assignment" value="180 * (abs(TMP_scalingFactor - RDP_radius) / RDP_radius)" variable="IO_arc_width" />
            </action>
            <action _location="line 571, column 17" condition="1" type="if">
              <action _location="line 572, column 34" type="assignment" value="IO_cursor_distance2center / RDP_radius" variable="IO_arc_alpha" />
              <action _location="line 573, column 37" type="assignment" value="IO_cursor_distance2center / RDP_radius" variable="IO_target_alpha" />
            </action>
            <action _location="line 575, column 17" condition="1" type="if">
              <action _location="line 576, column 33" type="assignment" value="(TMP_normJoyDir &gt;= IO_arc_trigger_min) &amp;&amp; (TMP_normJoyDir &lt;= IO_arc_trigger_max)" variable="IO_arc_flag" />
              <action _location="line 577, column 21" condition="IO_arc_flag" type="if">
                <action _location="line 578, column 41" type="assignment" value="0" variable="IO_target_col_r" />
                <action _location="line 579, column 41" type="assignment" value="0" variable="IO_target_col_g" />
                <action _location="line 580, column 41" type="assignment" value="0" variable="IO_target_col_b" />
              </action>
              <action _location="line 582, column 21" condition="IO_arc_flag == false" type="if">
                <action _location="line 583, column 41" type="assignment" value="0.5" variable="IO_target_col_r" />
                <action _location="line 584, column 41" type="assignment" value="0.5" variable="IO_target_col_g" />
                <action _location="line 585, column 41" type="assignment" value="0.5" variable="IO_target_col_b" />
              </action>
            </action>
            <action _location="line 588, column 17" type="update_stimulus_display" />
            <transition _location="line 589, column 17" target="Hit" type="goto" when="IO_arc_flag &amp;&amp; timer_expired(HoldDurationTimer)" />
            <transition _location="line 593, column 17" target="Check if target detected" type="goto" when="IO_arc_flag == false" />
            <transition _location="line 597, column 17" target="Hold target" timer="FrameTimer" type="timer_expired" />
          </task_system_state>
          <task_system_state _location="line 602, column 13" tag="Miss">
            <action _location="line 603, column 17" stimulus="target" type="dequeue_stimulus" />
            <action _location="line 604, column 17" type="update_stimulus_display" />
            <action _location="line 605, column 30" type="assignment" value="0" variable="IO_target_ON" />
            <action _location="line 606, column 31" type="assignment" value="&quot;miss&quot;" variable="TRIAL_outcome" />
            <action _location="line 607, column 17" message="--- OUTCOME: Miss ---" type="report" />
            <transition _location="line 608, column 17" target="Set up Target" type="goto" />
          </task_system_state>
          <task_system_state _location="line 610, column 13" tag="Hit">
            <action _location="line 611, column 17" sound="Reward" type="play_sound" />
            <action _location="line 612, column 17" stimulus="target" type="dequeue_stimulus" />
            <action _location="line 613, column 17" type="update_stimulus_display" />
            <action _location="line 614, column 30" type="assignment" value="0" variable="IO_target_ON" />
            <action _location="line 615, column 31" type="assignment" value="&quot;hit&quot;" variable="TRIAL_outcome" />
            <action _location="line 616, column 17" message="--- OUTCOME: Hit ---" type="report" />
            <action _location="line 617, column 37" type="assignment" value="1" variable="IO_start_area_col_g" />
            <action _location="line 618, column 17" duration="EXP_start_area_colorChange_ms" duration_units="ms" timer="ColorChangeTimer" type="start_timer" />
            <transition _location="line 623, column 17" target="Set up Target" type="goto" />
          </task_system_state>
          <task_system_state _location="line 625, column 13" tag="End Trial">
            <action _location="line 626, column 17" condition="1" type="if">
              <action _location="line 627, column 21" stimulus="target" type="dequeue_stimulus" />
              <action _location="line 628, column 21" stimulus="RDP" type="dequeue_stimulus" />
              <action _location="line 629, column 21" stimulus="start_area" type="dequeue_stimulus" />
              <action _location="line 630, column 21" stimulus="arc" type="dequeue_stimulus" />
              <action _location="line 631, column 21" stimulus="arcMask" type="dequeue_stimulus" />
            </action>
            <action _location="line 633, column 37" type="assignment" value="0" variable="IO_start_area_col_g" />
            <action _location="line 634, column 17" type="update_stimulus_display" />
            <action _location="line 635, column 17" condition="1" type="if">
              <action _location="line 636, column 29" type="assignment" value="0" variable="ML_sync" />
              <action _location="line 637, column 33" type="assignment" value="ML_trialEnd + 1" variable="ML_trialEnd" />
            </action>
            <action _location="line 639, column 17" message="===== TRIAL $ML_trialEnd ENDS=====" type="report" />
            <action _location="line 640, column 17" duration="EXP_ITI_ms" duration_units="ms" timer="ITI_Timer" type="start_timer" />
            <transition _location="line 645, column 17" target="ITI" type="goto" />
          </task_system_state>
          <task_system_state _location="line 647, column 13" tag="ITI">
            <action _location="line 648, column 17" duration="16" duration_units="ms" timer="FrameTimer" type="start_timer" />
            <action _location="line 653, column 17" condition="1" type="if">
              <action _location="line 654, column 33" type="assignment" value="-(EXP_Xmax * IO_joystickX_calib)" variable="IO_cursor_x" />
              <action _location="line 655, column 33" type="assignment" value="EXP_Ymax * IO_joystickY_calib" variable="IO_cursor_y" />
            </action>
            <transition _location="line 657, column 17" target="Wait for Joystick" timer="ITI_Timer" type="timer_expired" />
            <transition _location="line 661, column 17" target="ITI" timer="FrameTimer" type="timer_expired" />
          </task_system_state>
        </task_system>
      </trial>
    </protocol>
  </experiment>
  <variable_assignment variable="#loadedExperiment">
    <dictionary>
      <dictionary_element>
        <key>/Users/acalapai/ownCloud/Shared/Continous_Psychophisics/Experiments/20201102_CPR_TargetArc_anc[inprogress].mwel</key>
        <value type="string">
//
// I/O Devices
//

stimulus_display 'Stimulus Display' (0, 0, 0)
iodevice/mio mIO (
    data_interval = 1ms
    joystick_direction = IO_joystickDirection
    joystick_strength = IO_joystickStrength
    joystick_x_raw = IO_joystickX_raw
    joystick_y_raw = IO_joystickY_raw
    joystick_x_calib = IO_joystickX_calib
    joystick_y_calib = IO_joystickY_calib
    reward_a = IO_rewardA
    )
iodevice/mouse_input mouse (
    mouse_position_x = IO_mouse_x
    mouse_position_y = IO_mouse_y
    mouse_down = IO_mouse_down
    hide_cursor = YES
    use_mirror_window = YES
    )

//
// Variables
//

group EXP {
    var EXP_task = 0
    var EXP_Xmax = 15.2024
    var EXP_Ymax = 11.4018
    var EXP_snr_min = .9
    var EXP_snr_max = 1
    var EXP_SteadyStateDuration = 0
    var EXP_Time2Target = 0
    var EXP_directionChange_list = [45,90,135,180]
    var EXP_RDPdir_change = 0
    var EXP_steadyState_min = 500
    var EXP_trial_duration = 0
    var EXP_trial_min = 10000
    var EXP_trial_max = 20000
    var EXP_ITI_ms = 1000
    var EXP_HoldTarget_ms = 500
    var EXP_start_area_colorChange_ms = 500
}
group IO {
    var IO_mouse_x = (float)(0)
    var IO_mouse_y = (float)(0)
    var IO_mouse_down = (float)(0)
    var IO_joystickDirection = (float)(0)
    var IO_joystickStrength = 0
    var IO_joystickX_raw = 0
    var IO_joystickY_raw = 0
    var IO_joystickX_calib = (float)(0)
    var IO_joystickY_calib = (float)(0)
    var IO_start_area_flag = 0
    var IO_start_area_size = 2
    var IO_start_area_col_r = 0
    var IO_start_area_col_g = 0
    var IO_start_area_col_b = 0
    var IO_rewardA = 0
    var IO_cursor_distance2center = 0
    var IO_cursor_accuracy = 0
    var IO_cursor_accuracyDisplay = 0
    var IO_cursor_x = 0
    var IO_cursor_y = 0
}
group Target {
    var IO_target_size = 2
    var IO_target_ON = 0
    var IO_target_duration = 1000
    var IO_target_flag = 0
    var IO_target_x = 0
    var IO_target_y = 9.25
    var IO_target_alpha = 0.5
    var IO_target_col_r = .5
    var IO_target_col_g = .5
    var IO_target_col_b = .5
    var IO_arc_width = 0
    var IO_arc_size = 20
    var IO_arc_flag = 0
    var IO_arc_alpha = 0
    var IO_arc_trigger_min = 0.5
    var IO_arc_trigger_max = 0.5
    var IO_arcMask_size = 17
    var IO_arcMask_flag = 0
    var IO_arc_col_r = 1
    var IO_arc_col_g = 1
    var IO_arc_col_b = 0
}
group TMP {
    var alpha = 0
    var pi = 3.14159265359
    var TMP_stimDir = 0
    var TMP_joyDeviation = 0
    var TMP_normStimDir = 0
    var TMP_normJoyDir = 0
    var TMP_scalingFactor = 0
    var dice = 0
    var steady_ts = 0
}
group RDP {
    var RDP_radius = 8
    var RDP_direction = 0
    var RDP_controlled_x = 0
    var RDP_target_x = 0
    var RDP_y = 0
    var RDP_x = 0
    var RDP_density = 5
    var RDP_dotsize = 0.2
    var RDP_speed = 3
    var RDP_coherence = 0
    var RDP_lifetime = 0.3
}
group ML {
    var ML_trialEnd = 0
    var ML_trialStart = 0
    var ML_sync = (bool)(0)
    var TRIAL_outcome = 0
}

//
// Sounds
//

wav_file Reward ('./sounds/reward.wav')

//
// Stimuli
//

blank_screen Background ()
circular_fixation_point start_area (
    color = IO_start_area_col_r,IO_start_area_col_g,IO_start_area_col_b
    trigger_width = IO_start_area_size
    trigger_watch_x = IO_cursor_x
    trigger_watch_y = IO_cursor_y
    trigger_flag = IO_start_area_flag
    x_size = IO_start_area_size
    y_size = IO_start_area_size
    x_position = 0
    y_position = 0
    rotation = 0
    alpha_multiplier = .3
    )
stimulus/r_d_p RDP (
    radius = RDP_radius
    x_position = RDP_x
    y_position = RDP_y
    dot_density = RDP_density
    dot_size = RDP_dotsize
    color = 1,1,1
    alpha_multiplier = 1.0
    direction = RDP_direction
    speed = RDP_speed
    coherence = RDP_coherence
    lifetime = RDP_lifetime
    announce_dots = NO
    autoplay = YES
    )
circular_fixation_point cursor (
    color = IO_arc_col_r,IO_arc_col_g,IO_arc_col_b
    trigger_width = 0
    trigger_watch_x = 0
    trigger_watch_y = 0
    trigger_flag = 0
    x_size = 1
    y_size = 1
    x_position = -EXP_Xmax * IO_joystickX_calib
    y_position = EXP_Ymax * IO_joystickY_calib
    rotation = 0
    alpha_multiplier = 1
    )
circular_fixation_point target (
    color = IO_target_col_r,IO_target_col_g,IO_target_col_b
    trigger_width = IO_target_size
    trigger_watch_x = IO_cursor_x
    trigger_watch_y = IO_cursor_y
    trigger_flag = IO_target_flag
    x_size = IO_target_size
    y_size = IO_target_size
    x_position = IO_target_x
    y_position = IO_target_y
    rotation = 0
    alpha_multiplier = IO_target_alpha
    )
stimulus/advstimulus arc (
    trigger_width = IO_arc_size
    trigger_watch_x = IO_target_x
    trigger_watch_y = IO_target_y
    trigger_flag = IO_arc_flag
    x_size = IO_arc_size
    y_size = IO_arc_size
    x_position = 0
    y_position = 0
    shape = format("circle %d", (integer)IO_arc_width)
    color = IO_arc_col_r,IO_arc_col_g,IO_arc_col_b
    rotation = -(IO_joystickDirection-90 - IO_arc_width/2)
    alpha_multiplier = IO_arc_alpha
    version = 1
    autoplay = YES
    )
circular_fixation_point arcMask (
    color = 0.5,0.5,0.5
    trigger_width = IO_arcMask_size
    trigger_watch_x = IO_cursor_x
    trigger_watch_y = IO_cursor_x
    trigger_flag = IO_arcMask_flag
    x_size = IO_arcMask_size
    y_size = IO_arcMask_size
    x_position = 0
    y_position = 0
    rotation = 0
    alpha_multiplier = 1
    )
text feedback_accuracy (
    text = format("Accuracy: %d", IO_cursor_accuracyDisplay)
    font_name = Arial
    font_size = 20
    color = 1,1,1
    x_size = 10
    y_size = 10
    x_position = -10
    y_position = 3
    rotation = 0
    alpha_multiplier = 1
    )
text feedback_distance (
    text = format("Dist2Center: %d", IO_cursor_distance2center)
    font_name = Arial
    font_size = 20
    color = 1,1,1
    x_size = 10
    y_size = 10
    x_position = -10
    y_position = 4
    rotation = 0
    alpha_multiplier = 1
    )

//
// Filters
//


//
// Optimizers
//


//
// Resources
//


//
// Protocols
//

protocol CPR_steady {
    start_device_io (mIO)
    live_queue_stimulus (Background)
    live_queue_stimulus (cursor)
    live_queue_stimulus (feedback_accuracy)
    live_queue_stimulus (feedback_distance)
    update_stimulus_display ()
    start_timer (
        timer = ColorChangeTimer
        duration = 0.0
        duration_units = ms
        )
    trial 'Trial structure' {
        task LOOP {
            state 'Wait for Joystick' {
                start_timer (
                    timer = FrameTimer
                    duration = 16
                    duration_units = ms
                    )
                if (1) {
                    IO_cursor_x = -(EXP_Xmax * IO_joystickX_calib)
                    IO_cursor_y = EXP_Ymax * IO_joystickY_calib
                }
                queue_stimulus (start_area)
                update_stimulus_display ()
                goto (
                    target = 'New Trial'
                    when = IO_start_area_flag == true
                    )
                timer_expired (
                    target = 'Wait for Joystick'
                    timer = FrameTimer
                    )
            }
            state 'New Trial' {
                if (1) {
                    ML_sync = 1
                    ML_trialStart = ML_trialStart + 1
                    EXP_task = "Steady_Flip"
                }
                if (1) {
                    RDP_direction = disc_rand(0,359)
                    RDP_speed = 4
                    RDP_coherence = rand(EXP_snr_min, EXP_snr_max)
                }
                update_stimulus_display ()
                EXP_trial_duration = disc_rand(EXP_trial_min, EXP_trial_max)
                start_timer (
                    timer = TrialTimer
                    duration = EXP_trial_duration
                    duration_units = ms
                    )
                report ('===== TRIAL $ML_trialStart STARTS=====')
                goto ('Show Stimuli')
            }
            state 'Show Stimuli' {
                if (1) {
                    live_queue_stimulus (arc)
                    live_queue_stimulus (arcMask)
                    live_queue_stimulus (RDP)
                    live_queue_stimulus (start_area)
                    live_queue_stimulus (cursor)
                    update_stimulus_display ()
                }
                goto ('Set up Target')
            }
            state 'Set up Target' {
                EXP_Time2Target = 1500 * disc_rand(1,6)
                start_timer (
                    timer = TargetTimer
                    duration = EXP_Time2Target
                    duration_units = ms
                    )
                goto ('Set up steady state')
            }
            state 'Set up steady state' {
                EXP_SteadyStateDuration = disc_rand(1000,3000)
                start_timer (
                    timer = SteadyStateDurationTimer
                    duration = EXP_SteadyStateDuration
                    duration_units = ms
                    )
                start_timer (
                    timer = SteadyStateMinDurationTimer
                    duration = EXP_steadyState_min
                    duration_units = ms
                    )
                steady_ts = now()
                goto ('Update Stimuli')
            }
            state 'Update Stimuli' {
                start_timer (
                    timer = FrameTimer
                    duration = 16
                    duration_units = ms
                    )
                if (timer_expired(ColorChangeTimer)) {
                    IO_start_area_col_g = 0
                }
                if (1) {
                    IO_cursor_x = -(EXP_Xmax * IO_joystickX_calib)
                    IO_cursor_y = EXP_Ymax * IO_joystickY_calib
                }
                if (1) {
                    IO_arc_trigger_min = (((TMP_stimDir - (IO_arc_width/2) + 360) % 360) + ((180-TMP_stimDir) + 360)) % 360
                    IO_arc_trigger_max = (((TMP_stimDir + (IO_arc_width/2) + 360) % 360) + ((180-TMP_stimDir) + 360)) % 360
                }
                if (1) {
                    alpha = RDP_direction
                    if (alpha &gt;= 0 &amp;&amp; alpha &lt; 359) {
                        TMP_stimDir = alpha
                    }
                    if (alpha &gt; 359) {
                        TMP_stimDir = alpha - 359
                    }
                    if (alpha &lt; 0) {
                        TMP_stimDir = alpha + 359
                    }
                    IO_cursor_accuracy = abs(1 - abs(TMP_stimDir - (IO_joystickDirection - 90)) / 180)
                    IO_cursor_accuracyDisplay = round(IO_cursor_accuracy * 100) / 100
                }
                if (1) {
                    TMP_normJoyDir = (((IO_joystickDirection-90) + (180-TMP_stimDir) + 360) % 360) 
                    TMP_normStimDir = (((TMP_stimDir + 360) % 360) + ((180-TMP_stimDir) + 360)) % 360
                    TMP_joyDeviation = abs(TMP_normJoyDir - TMP_normStimDir)
                    IO_cursor_distance2center = sqrt(pow(IO_cursor_y,2) + pow(IO_cursor_x,2))
                }
                if (1) {
                    if (IO_cursor_distance2center &lt;= RDP_radius) {
                        TMP_scalingFactor = IO_cursor_distance2center
                    }
                    if (IO_cursor_distance2center &gt; RDP_radius) {
                        TMP_scalingFactor = RDP_radius
                    }
                    IO_arc_width = 180 * (abs(TMP_scalingFactor - RDP_radius)/RDP_radius)
                }
                if (1) {
                    IO_arc_alpha = IO_cursor_distance2center / RDP_radius
                    IO_target_alpha = IO_cursor_distance2center / RDP_radius
                }
                update_stimulus_display ()
                timer_expired (
                    target = 'Direction switch'
                    timer = SteadyStateDurationTimer
                    )
                goto (
                    target = 'Target presentation'
                    when = timer_expired(TargetTimer) &amp;&amp; timer_expired(SteadyStateMinDurationTimer)
                    )
                timer_expired (
                    target = 'End Trial'
                    timer = TrialTimer
                    )
                timer_expired (
                    target = 'Update Stimuli'
                    timer = FrameTimer
                    )
            }
            state 'Direction switch' {
                dice = disc_rand(0,1)
                EXP_RDPdir_change =  EXP_directionChange_list[disc_rand(0,3)]
                if (dice == 1) {
                    RDP_direction = RDP_direction + EXP_RDPdir_change
                }
                if (dice == 0) {
                    RDP_direction = RDP_direction - EXP_RDPdir_change
                }
                goto ('Set up steady state')
            }
            state 'Target presentation' {
                if (1) {
                    IO_target_x = sin((RDP_direction)*(pi/180))*(RDP_radius + (IO_target_size/2))
                    IO_target_y = cos((RDP_direction)*(pi/180))*(RDP_radius+ (IO_target_size/2))
                }
                live_queue_stimulus (target)
                IO_target_ON = 1
                start_timer (
                    timer = TargetDurationTimer
                    duration = IO_target_duration
                    duration_units = ms
                    )
                report ('--- SHOW TARGET ---')
                goto ('Check if target detected')
            }
            state 'Check if target detected' {
                start_timer (
                    timer = FrameTimer
                    duration = 16
                    duration_units = ms
                    )
                if (IO_start_area_col_g == 1) {
                    IO_start_area_col_g = 0
                }
                if (1) {
                    IO_cursor_x = -(EXP_Xmax * IO_joystickX_calib)
                    IO_cursor_y = EXP_Ymax * IO_joystickY_calib
                }
                if (1) {
                    IO_arc_trigger_min = (((TMP_stimDir - (IO_arc_width/2) + 360) % 360) + ((180-TMP_stimDir) + 360)) % 360
                    IO_arc_trigger_max = (((TMP_stimDir + (IO_arc_width/2) + 360) % 360) + ((180-TMP_stimDir) + 360)) % 360
                }
                if (1) {
                    alpha = RDP_direction
                    if (alpha &gt;= 0 &amp;&amp; alpha &lt; 359) {
                        TMP_stimDir = alpha
                    }
                    if (alpha &gt; 359) {
                        TMP_stimDir = alpha - 359
                    }
                    if (alpha &lt; 0) {
                        TMP_stimDir = alpha + 359
                    }
                    IO_cursor_accuracy = abs(1 - abs(TMP_stimDir - (IO_joystickDirection - 90)) / 180)
                    IO_cursor_accuracyDisplay = round(IO_cursor_accuracy * 100) / 100
                }
                if (1) {
                    TMP_normJoyDir = (((IO_joystickDirection-90) + (180-TMP_stimDir) + 360) % 360) 
                    TMP_normStimDir = (((TMP_stimDir + 360) % 360) + ((180-TMP_stimDir) + 360)) % 360
                    TMP_joyDeviation = abs(TMP_normJoyDir - TMP_normStimDir)
                    IO_cursor_distance2center = sqrt(pow(IO_cursor_y,2) + pow(IO_cursor_x,2))
                }
                if (1) {
                    if (IO_cursor_distance2center &lt;= RDP_radius) {
                        TMP_scalingFactor = IO_cursor_distance2center
                    }
                    if (IO_cursor_distance2center &gt; RDP_radius) {
                        TMP_scalingFactor = RDP_radius
                    }
                    IO_arc_width = 180 * (abs(TMP_scalingFactor - RDP_radius)/RDP_radius)
                }
                if (1) {
                    IO_arc_alpha = IO_cursor_distance2center / RDP_radius
                    IO_target_alpha = IO_cursor_distance2center / RDP_radius
                }
                if (1) {
                    IO_arc_flag = (TMP_normJoyDir &gt;= IO_arc_trigger_min) &amp;&amp; (TMP_normJoyDir &lt;=IO_arc_trigger_max)
                    if (IO_arc_flag) {
                        IO_target_col_r = 0
                        IO_target_col_g = 0
                        IO_target_col_b = 0
                    }
                    if (IO_arc_flag == false) {
                        IO_target_col_r = 0.5
                        IO_target_col_g = 0.5
                        IO_target_col_b = 0.5
                    }
                }
                update_stimulus_display ()
                start_timer (
                    timer = HoldDurationTimer
                    duration = EXP_HoldTarget_ms
                    duration_units = ms
                    )
                goto (
                    target = 'Hold target'
                    when = IO_arc_flag
                    )
                timer_expired (
                    target = Miss
                    timer = TargetDurationTimer
                    )
                timer_expired (
                    target = 'Check if target detected'
                    timer = FrameTimer
                    )
            }
            state 'Hold target' {
                start_timer (
                    timer = FrameTimer
                    duration = 16
                    duration_units = ms
                    )
                if (1) {
                    IO_cursor_x = -(EXP_Xmax * IO_joystickX_calib)
                    IO_cursor_y = EXP_Ymax * IO_joystickY_calib
                }
                if (1) {
                    IO_arc_trigger_min = (((TMP_stimDir - (IO_arc_width/2) + 360) % 360) + ((180-TMP_stimDir) + 360)) % 360
                    IO_arc_trigger_max = (((TMP_stimDir + (IO_arc_width/2) + 360) % 360) + ((180-TMP_stimDir) + 360)) % 360
                }
                if (1) {
                    alpha = RDP_direction
                    if (alpha &gt;= 0 &amp;&amp; alpha &lt; 359) {
                        TMP_stimDir = alpha
                    }
                    if (alpha &gt; 359) {
                        TMP_stimDir = alpha - 359
                    }
                    if (alpha &lt; 0) {
                        TMP_stimDir = alpha + 359
                    }
                    IO_cursor_accuracy = abs(1 - abs(TMP_stimDir - (IO_joystickDirection - 90)) / 180)
                    IO_cursor_accuracyDisplay = round(IO_cursor_accuracy * 100) / 100
                }
                if (1) {
                    TMP_normJoyDir = (((IO_joystickDirection-90) + (180-TMP_stimDir) + 360) % 360) 
                    TMP_normStimDir = (((TMP_stimDir + 360) % 360) + ((180-TMP_stimDir) + 360)) % 360
                    TMP_joyDeviation = abs(TMP_normJoyDir - TMP_normStimDir)
                    IO_cursor_distance2center = sqrt(pow(IO_cursor_y,2) + pow(IO_cursor_x,2))
                }
                if (1) {
                    if (IO_cursor_distance2center &lt;= RDP_radius) {
                        TMP_scalingFactor = IO_cursor_distance2center
                    }
                    if (IO_cursor_distance2center &gt; RDP_radius) {
                        TMP_scalingFactor = RDP_radius
                    }
                    IO_arc_width = 180 * (abs(TMP_scalingFactor - RDP_radius)/RDP_radius)
                }
                if (1) {
                    IO_arc_alpha = IO_cursor_distance2center / RDP_radius
                    IO_target_alpha = IO_cursor_distance2center / RDP_radius
                }
                if (1) {
                    IO_arc_flag = (TMP_normJoyDir &gt;= IO_arc_trigger_min) &amp;&amp; (TMP_normJoyDir &lt;=IO_arc_trigger_max)
                    if (IO_arc_flag) {
                        IO_target_col_r = 0
                        IO_target_col_g = 0
                        IO_target_col_b = 0
                    }
                    if (IO_arc_flag == false) {
                        IO_target_col_r = 0.5
                        IO_target_col_g = 0.5
                        IO_target_col_b = 0.5
                    }
                }
                update_stimulus_display ()
                goto (
                    target = Hit
                    when = IO_arc_flag &amp;&amp; timer_expired(HoldDurationTimer)
                    )
                goto (
                    target = 'Check if target detected'
                    when = IO_arc_flag == false
                    )
                timer_expired (
                    target = 'Hold target'
                    timer = FrameTimer
                    )
            }
            state Miss {
                dequeue_stimulus (target)
                update_stimulus_display ()
                IO_target_ON = 0
                TRIAL_outcome = "miss"
                report ('--- OUTCOME: Miss ---')
                goto ('Set up Target')
            }
            state Hit {
                play_sound (Reward)
                dequeue_stimulus (target)
                update_stimulus_display ()
                IO_target_ON = 0
                TRIAL_outcome = "hit"
                report ('--- OUTCOME: Hit ---')
                IO_start_area_col_g = 1
                start_timer (
                    timer = ColorChangeTimer
                    duration = EXP_start_area_colorChange_ms
                    duration_units = ms
                    )
                goto ('Set up Target')
            }
            state 'End Trial' {
                if (1) {
                    dequeue_stimulus (target)
                    dequeue_stimulus (RDP)
                    dequeue_stimulus (start_area)
                    dequeue_stimulus (arc)
                    dequeue_stimulus (arcMask)
                }
                IO_start_area_col_g = 0
                update_stimulus_display ()
                if (1) {
                    ML_sync = 0
                    ML_trialEnd = ML_trialEnd + 1
                }
                report ('===== TRIAL $ML_trialEnd ENDS=====')
                start_timer (
                    timer = ITI_Timer
                    duration = EXP_ITI_ms
                    duration_units = ms
                    )
                goto (ITI)
            }
            state ITI {
                start_timer (
                    timer = FrameTimer
                    duration = 16
                    duration_units = ms
                    )
                if (1) {
                    IO_cursor_x = -(EXP_Xmax * IO_joystickX_calib)
                    IO_cursor_y = EXP_Ymax * IO_joystickY_calib
                }
                timer_expired (
                    target = 'Wait for Joystick'
                    timer = ITI_Timer
                    )
                timer_expired (
                    target = ITI
                    timer = FrameTimer
                    )
            }
        }
    }
}
</value>
      </dictionary_element>
    </dictionary>
  </variable_assignment>
</monkeyml>
